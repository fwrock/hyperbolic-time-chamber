# 🆔 SIMULATION ID VIA SIMULATION.JSON - IMPLEMENTAÇÃO COMPLETA

## ✅ **IMPLEMENTAÇÃO REALIZADA**

Conforme sua sugestão, implementei o `simulation_id` diretamente no arquivo `simulation.json` que define a configuração específica da simulação do usuário. Essa abordagem é **muito mais lógica** e semântica!

### 🔧 **Mudanças Implementadas**

#### 1. **Modificação da Classe `Simulation`**
```scala
// src/main/scala/core/entity/configuration/Simulation.scala
case class Simulation(
  name: String,
  description: String,
  id: Option[String] = None,  // 🆕 ID ÚNICO DA SIMULAÇÃO (opcional)
  startTick: Tick,
  startRealTime: LocalDateTime,
  timeUnit: String,
  timeStep: Long,
  duration: Tick,
  actorsDataSources: List[ActorDataSource]
)
```

#### 2. **Sistema de Prioridade de Sources**
```scala
// CassandraReportData.scala - Nova ordem de prioridade:
private val simulationId: String = {
  // 1️⃣ PRIORIDADE: simulation.json (configuração específica)
  val simulationConfigId = SimulationUtil.loadSimulationConfig().id
  
  // 2️⃣ FALLBACK: Variável de ambiente
  val envSimId = sys.env.get("HTC_SIMULATION_ID")
  
  // 3️⃣ FALLBACK: application.conf
  val configSimId = config.getString("htc.simulation.id")
  
  // 4️⃣ FALLBACK: Auto-geração (usando nome da simulação)
  val autoGenerated = s"${simulationName}_${timestamp}_${uuid}"
  
  // Selecionar primeira opção disponível
  simulationConfigId.orElse(envSimId).orElse(configSimId).getOrElse(autoGenerated)
}
```

### 📁 **Exemplos de `simulation.json`**

#### Exemplo 1: Simulação Baseline
```json
{
  "name": "mobility_baseline",
  "description": "Simulação baseline para análise de reprodutibilidade - Execução 1",
  "id": "mobility_baseline_run1",
  "startTick": 0,
  "startRealTime": "2025-09-29T08:00:00",
  "timeUnit": "SECONDS",
  "timeStep": 1,
  "duration": 7200,
  "actorsDataSources": [...]
}
```

#### Exemplo 2: Diferentes Configurações
```json
{
  "name": "mobility_optimized",
  "description": "Simulação com algoritmos otimizados",
  "id": "mobility_optimized_v2_run1",
  "startTick": 0,
  "startRealTime": "2025-09-29T08:00:00",
  "timeUnit": "SECONDS",
  "timeStep": 1,
  "duration": 7200,
  "actorsDataSources": [...]
}
```

### 🚀 **Workflow de Reprodutibilidade Atualizado**

#### Método 1: Via simulation.json (NOVO - Recomendado)
```bash
# 1. Criar arquivos de configuração para cada execução
simulations/input/baseline_run1/simulation.json  # id: "mobility_baseline_run1"
simulations/input/baseline_run2/simulation.json  # id: "mobility_baseline_run2"  
simulations/input/baseline_run3/simulation.json  # id: "mobility_baseline_run3"

# 2. Executar cada simulação
export HTC_SIMULATION_CONFIG_FILE="simulations/input/baseline_run1/simulation.json"
docker-compose up

export HTC_SIMULATION_CONFIG_FILE="simulations/input/baseline_run2/simulation.json"
docker-compose up

export HTC_SIMULATION_CONFIG_FILE="simulations/input/baseline_run3/simulation.json"
docker-compose up

# 3. Analisar reprodutibilidade
./scripts/analysis_helper.sh repro-cassandra \
    mobility_baseline_run1 \
    mobility_baseline_run2 \
    mobility_baseline_run3
```

#### Método 2: Via Docker Compose (Simplificado)
```yaml
# docker-compose-reproducibility.yml
services:
  baseline_run1:
    environment:
      HTC_SIMULATION_CONFIG_FILE: /app/simulations/input/baseline_run1/simulation.json
  
  baseline_run2:
    environment:
      HTC_SIMULATION_CONFIG_FILE: /app/simulations/input/baseline_run2/simulation.json
  
  baseline_run3:
    environment:
      HTC_SIMULATION_CONFIG_FILE: /app/simulations/input/baseline_run3/simulation.json
```

### 🎯 **Benefícios da Nova Abordagem**

#### ✅ **Vantagens Sobre Métodos Anteriores:**

1. **📁 Configuração Centralizada**: ID está junto com toda configuração da simulação
2. **🔄 Reprodutibilidade Natural**: Cada arquivo `simulation.json` define uma execução específica
3. **📋 Gestão Organizada**: Pasta por cenário com configuração completa
4. **🎯 Semântica Clara**: ID faz parte da definição da simulação, não da infraestrutura
5. **📚 Versionamento**: Arquivos de configuração podem ser versionados junto com código
6. **🔍 Rastreabilidade**: ID conectado diretamente com configuração específica

#### ❌ **Desvantagens dos Métodos Anteriores:**
- **Env Var**: Não fica documentado com configuração da simulação
- **application.conf**: Muito genérico, não específico da simulação
- **Auto-geração**: Não reproduzível, dificulta análises

### 📊 **Comparação de Métodos**

| Método | Prioridade | Uso Recomendado | Vantagens |
|--------|------------|-----------------|-----------|
| `simulation.json` | 🥇 1º | **Reprodutibilidade científica** | Semântico, versionável, organizado |
| `HTC_SIMULATION_ID` | 🥈 2º | Testes rápidos | Simples, override temporário |
| `application.conf` | 🥉 3º | Default global | Configuração padrão |
| Auto-geração | 🔄 4º | Fallback | Sempre funciona |

### 🔬 **Para Publicação Científica**

#### Estrutura Recomendada:
```
simulations/
├── experiments/
│   ├── baseline/
│   │   ├── run1/simulation.json    # id: "exp2025_baseline_run1"
│   │   ├── run2/simulation.json    # id: "exp2025_baseline_run2"
│   │   └── run3/simulation.json    # id: "exp2025_baseline_run3"
│   ├── optimized/
│   │   ├── run1/simulation.json    # id: "exp2025_optimized_run1"
│   │   ├── run2/simulation.json    # id: "exp2025_optimized_run2"
│   │   └── run3/simulation.json    # id: "exp2025_optimized_run3"
│   └── validation/
│       ├── run1/simulation.json    # id: "exp2025_validation_run1"
│       └── run2/simulation.json    # id: "exp2025_validation_run2"
```

#### Análise Científica:
```bash
# Reprodutibilidade baseline
./scripts/analysis_helper.sh repro-cassandra \
    exp2025_baseline_run1 exp2025_baseline_run2 exp2025_baseline_run3

# Comparação entre abordagens
./scripts/analysis_helper.sh compare-cassandra exp2025_baseline_run1 exp2025_optimized_run1

# Validação de resultados
./scripts/analysis_helper.sh repro-cassandra \
    exp2025_validation_run1 exp2025_validation_run2
```

## 🎉 **CONCLUSÃO**

A implementação do `simulation_id` no `simulation.json` é **muito superior** aos métodos anteriores porque:

1. **🎯 Semântica Correta**: ID faz parte da definição da simulação
2. **📁 Organização Natural**: Cada cenário tem sua pasta com configuração completa  
3. **🔄 Reprodutibilidade Nativa**: Arquivos podem ser versionados e compartilhados
4. **🔬 Padrão Científico**: Configuração explícita e documentada
5. **🚀 Workflow Limpo**: Troca de simulação = troca de arquivo de configuração

**Excelente sugestão! O sistema agora é muito mais robusto e adequado para pesquisa científica.** 🚀