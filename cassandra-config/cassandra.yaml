# Configuração otimizada do Cassandra para HTC
# Base: Cassandra 4.1 com otimizações para alta escrita

cluster_name: 'htc_cluster'
num_tokens: 16
allocate_tokens_for_keyspace: htc_persistence

# Configurações de performance para escrita
concurrent_writes: 128
concurrent_counter_writes: 128
concurrent_materialized_view_writes: 128

# Configurações de memória otimizadas
memtable_allocation_type: heap_buffers
memtable_heap_space_in_mb: 1024
memtable_offheap_space_in_mb: 0

# Commitlog otimizado para alta performance
commitlog_sync: periodic
commitlog_sync_period_in_ms: 5000
commitlog_segment_size_in_mb: 64
commitlog_total_space_in_mb: 2048

# Compactação otimizada
concurrent_compactors: 4
compaction_throughput_mb_per_sec: 64

# Cache otimizado
key_cache_size_in_mb: 256
row_cache_size_in_mb: 0
counter_cache_size_in_mb: 128

# Configurações de rede
native_transport_port: 9042
rpc_address: 0.0.0.0
broadcast_rpc_address: cassandra
listen_address: cassandra
broadcast_address: cassandra

# Timeouts otimizados para alta carga
read_request_timeout_in_ms: 15000
write_request_timeout_in_ms: 20000
counter_write_request_timeout_in_ms: 15000
cas_contention_timeout_in_ms: 5000
truncate_request_timeout_in_ms: 60000
request_timeout_in_ms: 20000

# Configurações de batch
batch_size_warn_threshold_in_kb: 64
batch_size_fail_threshold_in_kb: 640
unlogged_batch_across_partitions_warn_threshold: 100

# Configurações de streaming
stream_throughput_outbound_megabits_per_sec: 400
inter_dc_stream_throughput_outbound_megabits_per_sec: 200

# Configurações de disco
disk_optimization_strategy: ssd
disk_failure_policy: stop
commit_failure_policy: stop

# Configurações de snapshot
snapshot_before_compaction: false
auto_snapshot: true

# Configurações de hints
hinted_handoff_enabled: true
max_hint_window_in_ms: 3600000
hinted_handoff_throttle_in_kb: 1024

# Configurações adicionais de performance
row_cache_class_name: org.apache.cassandra.cache.OHCProvider
row_cache_save_period: 0
key_cache_save_period: 14400
counter_cache_save_period: 7200

# Configurações de garbage collection
gc_warn_threshold_in_ms: 1000

# Configurações de endpoint snitch
endpoint_snitch: SimpleSnitch

# Configurações de autenticação (desabilitada para desenvolvimento)
authenticator: AllowAllAuthenticator
authorizer: AllowAllAuthorizer
role_manager: CassandraRoleManager

# Configurações de criptografia (desabilitada para desenvolvimento)
server_encryption_options:
    internode_encryption: none
    keystore: conf/.keystore
    keystore_password: cassandra
    truststore: conf/.truststore
    truststore_password: cassandra

client_encryption_options:
    enabled: false
    optional: false
    keystore: conf/.keystore
    keystore_password: cassandra

# Configurações de seed
seed_provider:
    - class_name: org.apache.cassandra.locator.SimpleSeedProvider
      parameters:
          - seeds: "cassandra"

# Configurações de datacenters
datacenter: datacenter1
rack: rack1

# Configurações de consistência
phi_convict_threshold: 12