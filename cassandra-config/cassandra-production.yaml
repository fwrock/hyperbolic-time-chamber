# Configuração Cassandra para Produção GCP
# Otimizada para alta performance com cluster de 3 nós
# VM: n2-highmem-128 (128 vCPUs, 512GB RAM)

cluster_name: 'HTC_Production_Cluster'
num_tokens: 16
allocate_tokens_for_keyspace: htc_persistence

# Configurações de performance para produção de alta escala
concurrent_reads: 64
concurrent_writes: 256
concurrent_counter_writes: 64
concurrent_materialized_view_writes: 64

# Configurações de memória otimizadas para grandes datasets
memtable_allocation_type: heap_buffers
memtable_heap_space_in_mb: 8192
memtable_offheap_space_in_mb: 0
memtable_cleanup_threshold: 0.2

# Commitlog otimizado para throughput máximo
commitlog_sync: periodic
commitlog_sync_period_in_ms: 2000
commitlog_segment_size_in_mb: 128
commitlog_total_space_in_mb: 8192
commitlog_compression:
  - class_name: LZ4Compressor

# Compactação agressiva para performance
concurrent_compactors: 8
compaction_throughput_mb_per_sec: 256
sstable_preemptive_open_interval_in_mb: 50

# Cache otimizado para grandes volumes
key_cache_size_in_mb: 1024
key_cache_save_period: 3600
row_cache_size_in_mb: 2048
row_cache_save_period: 3600
counter_cache_size_in_mb: 512
counter_cache_save_period: 3600

# Configurações de rede para cluster
native_transport_port: 9042
rpc_address: 0.0.0.0
broadcast_rpc_address_type: interface
broadcast_rpc_address: eth0
listen_address_type: interface  
listen_interface: eth0
broadcast_address_type: interface
broadcast_interface: eth0

# Timeouts otimizados para alta carga de produção
read_request_timeout_in_ms: 30000
write_request_timeout_in_ms: 60000
counter_write_request_timeout_in_ms: 30000
cas_contention_timeout_in_ms: 10000
truncate_request_timeout_in_ms: 300000
request_timeout_in_ms: 60000

# Configurações de batch para simulações grandes
batch_size_warn_threshold_in_kb: 128
batch_size_fail_threshold_in_kb: 1280
unlogged_batch_across_partitions_warn_threshold: 1000

# Configurações de streaming para replicação
stream_throughput_outbound_megabits_per_sec: 1000
inter_dc_stream_throughput_outbound_megabits_per_sec: 1000

# Configurações de disco para alta performance
disk_optimization_strategy: ssd
disk_failure_policy: stop
commit_failure_policy: stop

# Configurações de snapshot para produção
snapshot_before_compaction: false
auto_snapshot: true
incremental_backups: false

# Configurações de hints
hinted_handoff_enabled: true
max_hint_window_in_ms: 3600000
hinted_handoff_throttle_in_kb: 4096
max_hints_delivery_threads: 4

# Configurações adicionais de performance
row_cache_class_name: org.apache.cassandra.cache.OHCProvider
prepared_statements_cache_size_mb: 256
thrift_prepared_statements_cache_size_mb: 256

# Configurações de garbage collection
gc_warn_threshold_in_ms: 5000

# Configurações de endpoint snitch para GCP
endpoint_snitch: GossipingPropertyFileSnitch

# Configurações de autenticação (produção)
authenticator: PasswordAuthenticator
authorizer: CassandraAuthorizer
role_manager: CassandraRoleManager

# Configurações de criptografia inter-nó
server_encryption_options:
    internode_encryption: none  # Pode ser habilitada se necessário
    keystore: conf/.keystore
    keystore_password: cassandra
    truststore: conf/.truststore
    truststore_password: cassandra
    protocol: TLS
    algorithm: SunX509
    store_type: JKS
    cipher_suites: [TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA]
    require_client_auth: false

# Configurações de criptografia cliente
client_encryption_options:
    enabled: false
    optional: false
    keystore: conf/.keystore
    keystore_password: cassandra

# Configurações de seed para cluster
seed_provider:
    - class_name: org.apache.cassandra.locator.SimpleSeedProvider
      parameters:
          - seeds: "cassandra-seed"

# Configurações de datacenter
datacenter: gcp-us-central1
rack: rack1

# Configurações de consistência
phi_convict_threshold: 12

# Configurações de replicação para produção
auto_bootstrap: true

# Configurações de indexing secundário
column_index_size_in_kb: 64
column_index_cache_size_in_kb: 2

# Configurações de compressão
# Habilitar compressão para economizar espaço
sstable_compression: org.apache.cassandra.io.compress.LZ4Compressor

# Configurações de bloom filter
bloom_filter_fp_chance: 0.01

# Configurações de SSTable
sstable_preemptive_open_interval_in_mb: 50

# Configurações de inter-node
internode_compression: dc
inter_dc_tcp_nodelay: false

# Configurações de partitioner
partitioner: org.apache.cassandra.dht.Murmur3Partitioner

# Configurações de data directories
data_file_directories:
    - /var/lib/cassandra/data

# Configurações de commit log
commitlog_directory: /var/lib/cassandra/commitlog

# Configurações de saved caches
saved_caches_directory: /var/lib/cassandra/saved_caches

# Configurações de hints
hints_directory: /var/lib/cassandra/hints

# Configurações de CDC
cdc_enabled: false